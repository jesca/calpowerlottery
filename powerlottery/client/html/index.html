<template name="main">
  <!-- Signed in -->

  {{#if currentUser}}

  {{#contentFor "headerTitle"}}
  <div class="logo"></div>
  {{/contentFor}}

  {{#contentFor "headerButtonRight"}}
  <button class="button button-clear" data-ion-popover="_sideMenu">{{> ionIcon icon="android-menu" class = "menu-icon"}}</button>
  {{/contentFor}}


{{#ionView}}


{{#ionContent}}


  {{#if ac_on}}
  <div class = "row bordered ac-on">
    <div class = "ac-info ">
      <p class = "thin white">{{> ionIcon icon="flash margin"}}    Your AC is currently ON.</p>
</div>
</div>
  {{else}}
  {{#if ac_disconnected}}
  <div class = "row bordered ac-dsc" data-action="showPopupDscAC">
    <div class = "ac-info ">

<p class = "thin white">{{> ionIcon icon="alert margin"}}    Your AC is currently disconnected. </p>
    </div>
  </div>
  {{else}}
  <div class = "row bordered ac-off">
    <div class = "ac-info ">
      <p class = "thin white">{{> ionIcon icon="leaf margin"}}    Your AC is currently OFF.</p>
    </div>
    </div>
  {{/if}}
  {{/if}}


<div class = "not-fullscreen background main-info" style = "	background-image:url('/img/world.png') !important;">
   <div class = "row padding-top">
    <div class = "col">
      <p class = "centered name white">Hello {{name}}. You have</p>
    </div>
  </div>
  <div class = "row">
    <div class = "col margin-bottom">
      <div class = "centered tokens">{{tokens}}</div>
    </div>
  </div>
  <div class = "row">
    <div class = "col">
      <p class = "centered white">tokens from {{offers_completed}} challenges</p>
    </div>
  </div>
</div>

<div class = "row under-main">
  <div class = "col">
  <h4 class="white">{{name}}'s Powerly History</h4>
</div>
</div>

{{#if hasOffer}}
<div class="row">
    <div class="col">
        <div class="card">
            <div class="item item-text-wrap">
                <div class="row">
                  <div class = "col">
                     <p>Accept offer by:</p><br></div></div>
                     <div class = 'row offer'>
                       <div class = "col">
                         <div class = "timer thin">{{minutes}}:{{seconds}}</div>
                       </div>
                      </div>
                      <div class = "row">
                        <div class ="col">
                        <p> minutes    &nbsp;&nbsp;&nbsp;   seconds</p></div>
                      </div>


                    <p>
                    Tokens offered: {{offer.tokensOffered}}
                    to keep your AC off for 60 minutes</p>

                    <div class="col"></div>
                    {{#if ac_on}}
                        <button class="button button-light">
                        Turn AC Off to Accept
                        </button>
                    {{else}}
                        {{#if ac_disconnected}}
                            <button class="button button-light">
                            Connect AC to accept
                            </button>
                        {{else}}
                            <button id="acceptOffer" class="button button-balanced">
                            Accept
                            </button>
                        {{/if}}
                    {{/if}}
                </div>
            </div>
        </div>
    </div>
 {{/if}}

{{#if inGame}}
<div class="row">
    <div class="col">
        <div class="card">
            <div class="item item-text-wrap">
                <div class="row">
                Keep it up! Keep your AC OFF for:
                    {{minutes}}:{{seconds}}

                </div>
            </div>
        </div>
    </div>
</div>
{{/if}}

{{#if failed}}
<div class="row">
    <div class="col">
        <div class="card">
            <div class="item item-text-wrap">
                <div class="row">
                    Sorry, we detected that your AC was disconnected or turned on before time was up.
                    You have been disqualified from this challenge.

                     <button id = "acknowledgeFailure" class="button button-assertive">
                        OK
                      </button>
                </div>
            </div>
        </div>
    </div>
</div>
{{/if}}


{{#if success}}
<div class="row">
    <div class="col">
        <div class="card">
            <div class="item item-text-wrap">
                <div class="row">
                   Awesome! {{ offer.tokensOffered }} tokens have been added to your account.
                    <button id = "acknowledgeSuccess" class="button button-energized">
                        OK
                    </button>

                </div>
            </div>
        </div>
    </div>
</div>
{{/if}}


{{>history_list}}

{{/ionContent}}
{{> _tabs}}

{{/ionView}}
{{/if}}
</template>

<template name = "history_list">
   {{#each getHistory}}

    {{#ionItem class="gray-bg"}}
    <div class = "row">

      <div class = "col">
        <div class = "middle">
          <div class='token-count'>{{tokens}}</div>
          {{#if succeededOffer}}
          <p class = "thin">Tokens rewarded</p>
          {{else}}
          <p class = "thin">So close!</p>
          {{/if}}
        </div>
      </div>
    <div class = "col">
      <div class = "thin middle time">{{timeOffer}} </div>
    </div>
    <div class = "col">
      {{#if succeededOffer }}
      <div class= "middle">
        {{> ionIcon icon="cash" class = "succeed"}}
      </div>
      {{else}}
      <div class= "middle">
        {{> ionIcon icon="cash" class="gray-font"}}</div>
      {{/if}}
   </div>
  </div>

    {{/ionItem}}
  {{/each}}
 </template>
